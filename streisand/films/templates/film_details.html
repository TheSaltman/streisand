{% extends 'base.html' %}
{% load humanize %}

{% block title %}{{ film }}{% endblock %}

{% block main %}
    <div class="page-header">
      <h1>{{ film }}</h1>
      <img src="{{ film.poster_url }}" width="250px" />
    </div>
    {% for tag in film.tags.all %}
      <span class="label label-default">{{ tag }}</span>
    {% endfor %}
    <p></p>
    <div class="well">
      {% if film.rotten_tomatoes %}
      <p>RT critics rating: <strong>{{ film.rotten_tomatoes.critics_rating }}</strong> ({{ film.rotten_tomatoes.critics_rating_string }})</p>
      <p>RT audience rating: <strong>{{ film.rotten_tomatoes.audience_rating }}</strong> ({{ film.rotten_tomatoes.audience_rating_string }})</p>
      {% endif %}
      <p>IMDb rating: <strong>{{ film.imdb.rating }}</strong> ({{ film.imdb.rating_vote_count|intcomma }} votes)</p>
    </div>

    <h2>Torrents</h2>
    <div class="list-group">
      {% for torrent in film.torrents.all %}
        <span class="list-group-item{% if torrent.id == torrent_id %} active{% endif %}">
          <h4 class="list-group-item-heading">
            {{ torrent.codec }}
            /
            {{ torrent.container }}
            /
            {{ torrent.resolution }}
            /
            {{ torrent.source_media }} ({{ torrent.size_in_bytes|filesizeformat }})
          </h4>
          <div class="well">
            uploaded
            {% if torrent.uploaded_by %}
              by <a href="{{ torrent.uploaded_by.get_absolute_url }}">{{ torrent.uploaded_by.username }}</a>
            {% endif %}
            <span title="{{ torrent.uploaded_at }}">{{ torrent.uploaded_at|naturaltime }}</span>
            <br />
            {% if torrent.is_approved == True %}
              approved by {{ torrent.moderated_by }}
            {% elif torrent.is_approved == False %}
              work in progress
            {% else %}
              not yet moderated
            {% endif %}
            {% if not torrent.is_approved %}
            <br />
            <form action="{% url 'torrent_moderation' torrent_id=torrent.id %}" method="post">
              {% csrf_token %}
              <input type="hidden" name="moderation_status" value="approved" />
              <input type="submit" value="Approve" />
            </form>
            {% endif %}
          </div>
          | <a name="torrent-pl-{{ torrent.id }}" href="{{ torrent.get_absolute_url }}">PL</a>
          | <a name="torrent-dl-{{ torrent.id }}" href="{% url 'torrent_download' torrent_id=torrent.id announce_key=user.profile.announce_key_id %}">DL</a>
          {% if torrent.is_accepting_reseed_requests and 'torrents.can_request_reseed' in perms %}
          | <a name="torrent-rr-{{ torrent.id }}" href="{% url 'reseed_request' torrent_id=torrent.id %}">RR</a>
          {% endif %}
          | {{ torrent.release_name }}<br/>
          {% if torrent.reseed_request %}
          Reseed requested <span title="{{ torrent.reseed_request.created_at }}">{{ torrent.reseed_request.created_at|naturaltime }}</span>
          {% endif %}
          <ul>
            {% for file in torrent.file_list %}
              <li>{{ file }}</li>
            {% endfor %}
          </ul>
          {% if torrent.nfo %}
            <pre>{{ torrent.nfo }}</pre>
          {% endif %}
          {% if torrent.description %}
            <div class="well">{{ torrent.description }}</div>
          {% endif %}
        </span>
      {% endfor %}
      </div>

    <h2>Comments</h2>
    <div class="col-sm-8">
      <div class="list-group">
        {% for comment in film.comments.all %}
          <div class="list-group-item">
            <h4 class="list-group-item-heading">
              <a href="{{ comment.author.get_absolute_url }}">{{ comment.author.username }}</a>
              <span title="{{ comment.created_at }}">{{ comment.created_at|naturaltime }}</span>
            </h4>
            <p class="list-group-item-text">{{ comment.text }}</p>
          </div>
        {% endfor %}
      </div>
    </div>
{% endblock %}
